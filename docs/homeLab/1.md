# Version1

## 简介

> 本文内容最初记录于2015年2月，整理并发布于2021年10月

考研经费剩下了小几千块钱，考虑过年前不买衣服，全部用来买电子设备。最让我心动的计划就是动手组建第一台NAS，基本需求就是一台不用关机的下载机、存储池。

## 剁手

本来考虑了群晖的成品nas，但是太贵，性价比不够高。

后来又考察了心仪已久的Mac mini。因为我的卧室里去年添置了一台philips的27寸显示器，一直在配合笔记本双屏幕使用，所以考虑可以购入mac mini，使得macmini成为卧室主力，就可以告别Y570笔记本上的黑苹果了，并且由于其功率极低，当然就不需要关机了，同时可以解放笔记本，随时床上使用。但是这一方案最终也没采用。原因主要有这么几点：第一，mac mini 2014的升级版确实不够给力，自己又有点强迫倾向，总想着要买就买新产品；第二，mac mini的方案存储方面不够强悍，而且升级不方便，未来升级成本也不菲。

在知乎搜索后，发现一款入门级服务器：HP N54L，价格比前两者都低，京东1600入手。虽然淘宝上的日本代购价格可低至1000，甚至更低，但是鉴于年前比较忙，无心折腾海淘，所以没有选择代购。

京东上的N54L配置不带硬盘，配有4G内存，所以搭配它一起入手的还有一块儿金士顿120GB的SSD（后来证明买大了，不折腾太多系统的话60GB的足矣）、大D4pin转sata线、sata数据线和一块3TB西数绿盘用来当数据盘。还有一个TP的路由器用来扩展家里的无线网，这个跟NAS关系不大。

<img src="https://cdn.wubw.fun/typora/210930-214107-IMG_0337.JPG" alt="IMG_0337" style="zoom:50%;" />

## Setup

第一次接触服务器级别的产品，通过HP的这个NAS，了解了ECC内存，以及Raid的相关概念。

硬件上，我的方案是通过大D4pin转sata线，把光驱位的电源用来给SSD供电，然后用Sata数据线连接ssd和主板上的ODD接口，也就是原本用来连接光驱的数据线，这是个sata2接口，不过也够用了。然后数据盘就是一块儿西数绿盘了。

硬件方面遇到的一个问题是，看论坛上的大神们说n54l有六个sata口，我想应该是算上机箱后部的esata口了，所以买了一个esata的易驱线，准备连接我的一块儿1TB笔记本硬盘。结果发现这货连在N54l上没有反应，而连在笔记本上的esata口时功能却正常。在笔记本上esata口是即插即用的，但是目前在这台服务器上还做不到即插即用，需要重启才能看见esata口上连接的硬盘，虽然我已经在bios里开启了sata的ahci模式。

软件上，最终选用了Windows Server 2012，同时安装了hyper-v组件以虚拟出一个centos系统备用。文件共享直接使用windows下的samba协议，简单易用。

## 硬盘故障

15年11月21日：

>2015年年初，刚考完研，憋了一年的欲望终于有机会得到释放---买买买！大三大四这两年最能勾起我好奇心和向往的应该就是NAS这个听起来高大上，用起来接地气的东西了。所以一回到家马上开始着手研究用剩下的考研经费入个NAS到家。
>
>然后一个偶然的机会，在知乎翻相关的回答时，看到了一个答主推荐HP的N54L迷你服务器：比NAS更灵活的NAS，还能装黑群晖。当时看了以后热血沸腾，终于有的折腾了。最后算了算价钱，也不算太贵，于是就在京东果断入手了HP N54L。随之而买的，还有一块儿SSD，一块儿HDD，线若干。
>
>今天要说的主角就是那块儿HDD：西数绿盘3TB版本。
>
>前两天这块儿3TB的硬盘快装满了，剩下最后几十G的时候，我发现访问时会出现几分钟的无响应时间，最后排查感觉可能是硬盘出问题了。于是翻出HDtune和diskgenius开始检修。不测不知道，一测吓一跳，这块儿绿盘用diskgenius查出4000多坏道，更蛋疼的是修复的时候每次到第20个就会卡住不动，根本无法修复。
>
>经过这件事，以后我肯定会主动避免使用西数绿盘了，甚至之前对于西部数据不错的印象都有所减分。不过貌似前一段听说西数绿盘这个产品线要被并进蓝盘了，可能以后也没机会买到西数绿盘了。
>
>卖了单位发的手机，凑了钱买了新硬盘：HGST NAS 6T，废了半天劲把能挽救的数据复制了一部分到新硬盘，然后就申请了京东售后。不知道为啥这次售后无法申请京东快递上门取件，必须得我自己发快递过去或者送到京东自提点，最后花了18顺丰给京东。
>
>本来以为得过上几个月了，等着京东联系WD，然后检测维修。所以心里都准备不想这事了，结果没过几天，一个江苏的号打来电话，告诉我检测到确实有问题，且维修可能耗时很久，问我能否接受八折退款，我毫不犹豫地接受了，700买入，退回来560左右。

## hyper-v中centos6.5网卡驱动安装

### 安装

在Hyper-v中添加虚拟机并加载CentOS6.5的minimal版本iso，一步一步安装，这一步无难度。

### 网卡驱动安装

安装完成CentOS6.5后，网卡是不能使用的，需要安装微软为Hyper-v中的linux准备的集成服务，才能驱动网卡。下载地址：[微软官方下载](http://www.microsoft.com/zh-CN/download/details.aspx?id=41554)

下载得到LinuxICv35.iso后，在hyper-v当前虚拟机的菜单栏里加载之，然后使用以下命令安装

```
mount /dev/cdrom /media
cd /media/RHEL63
./install.sh
```

安装后reboot。

之后需要修改网卡配置文件使得网卡开机自动加载

```
vi /etc/sysconfig/network-scripts/ifcfg-eth0
```

将onboot=no 改为onboot=yes

再次reboot后即可上网。



